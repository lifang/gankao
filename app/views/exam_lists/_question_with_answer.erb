<div class="part_question">
  <% attr="" %>
  <div class="part_q_text">
    <%=  question_with_answer.elements['title'].text %>
    <div class="fraction_h">10分</div>
  </div>
  <% question_with_answer.elements["questions"].each_element do |question| %>
    <% attr +=question.attributes["id"]+","
    attrs_str = question.elements["questionattrs"].text
    attrs_array = attrs_str.split(";-;") unless attrs_str.nil?
    correct_type = question.attributes["correct_type"]
    answer = question.elements["answer"]
    answers = (answer.nil? or answer.text.nil?) ? [] : answer.text.split(";|;")
    user_answer = question.get_elements("#{question.xpath}/user_answer")[-1].text
    user_answers=user_answer.nil? ? [] :  user_answer.split(";|;") %>
    <div class="p_question_list question_no"  >
      <div class="p_q_l_left"><%= question.attributes["id"] %></div>
      <div class="p_q_l_right_b" onmouseover="javascript:show_question('<%= question.attributes["id"] %>')" >
        <div class="question_title">
          <% unless  question.elements['description'].nil? || question.elements['description'].text.nil?%>
            <p style="word-wrap:break-word; word-break:break-all;" id="question_info_<%= question_with_answer.attributes["id"] %>">
              <% title = question.elements['description'].text.to_s.html_safe %>
              <% if title =~ /<mp3>/  %>
                <script type="text/javascript">audio_element("<%= title.split("<mp3>")[1] %>");</script>
                <%= title.split("<mp3>")[2].to_s.html_safe.
                  gsub("problem_x_dropplace", "problem_#{question_with_answer.attributes["id"]}_dropplace") %>
                <script type="text/javascript">
                  droppable_element('<%= title.split("<mp3>")[2].to_s.html_safe %>', <%= question_with_answer.attributes["id"] %>);
                </script>
              <% else %>
                <% description=question.elements['description'].text.to_s.html_safe.
                  gsub("problem_x_dropplace", "problem_#{question_with_answer.attributes["id"]}_dropplace") %>
                <%= description %>
              <% end %>
            </p>
          <% end %>
          <script type="text/javascript">
           droppable_result('<%= answers.join(",") %>', '<%= user_answers.join(",") %>', <%= question_with_answer.attributes["id"] %>);
          </script>
        </div>
        <span id="user_score_<%= question.attributes["id"].to_i %>">
        </span>
        <% if (correct_type.to_i == Problem::QUESTION_TYPE[:MORE_CHOSE] or
              correct_type.to_i == Problem::QUESTION_TYPE[:SINGLE_CHOSE]) %>
          <ul class="chooseQuestion">
            <%
            (0..attrs_array.length-1).each do |i|
              is_answer = answers.include?(attrs_array[i])
              is_user_answer=user_answers.include?(attrs_array[i])
            %>
              <li <% if is_answer %> class="correctRight_bg" <% end %>>
                <% if correct_type.to_i == Problem::QUESTION_TYPE[:MORE_CHOSE] %>
                  <input type="checkbox" name="question_attr_<%= question.attributes["id"].to_i %>"
                         id="question_attr_<%= i %>"  <% if is_user_answer %>checked="true"<% end %> disabled/>
                       <% elsif correct_type.to_i == Problem::QUESTION_TYPE[:SINGLE_CHOSE] %>
                  <input type="radio" name="question_attr_<%= question.attributes["id"].to_i %>"
                         id="question_attr_<%= i %>" <% if is_user_answer %>checked="true"<% end %> disabled/>
                <% end %>&nbsp;&nbsp;<%= attrs_array[i] %>
              </li>
            <% end if attrs_array and attrs_array.any? %>
          <% elsif correct_type.to_i == Problem::QUESTION_TYPE[:JUDGE] %>
            <div <% if answers[0].to_i==1 %>class="correctRight_bg"<% end %>>
              <input type="radio"<% if user_answer==1.to_s %> checked="true"<% end %> disabled/><label>对</label>
            </div>
            <div <% if answers[0].to_i==0 %>class="correctRight_bg"<% end %>>
              <input type="radio"  <% if user_answer==0.to_s %> checked="true"<% end %> disabled /><label>错</label>
            </div>
          <% elsif correct_type.to_i == Problem::QUESTION_TYPE[:SINGLE_CALK] %>
            <div class="answer_text">
              <input name="answer" type="text" value="<%= user_answers[0].to_s %>" disabled/>
            </div>
          <% elsif correct_type.to_i == Problem::QUESTION_TYPE[:CHARACTER] %>
            <div class="answer_textarea">
              <textarea cols="" rows=""readonly><%= user_answers[0].to_s %></textarea>
            </div>
          <% end %>
        </ul>
        <div class="p_question_btn" style="display: none;"><button class="save">保存</button><button class="Uncertain">不确定</button></div>
        <div class="fraction"><%= question.attributes["score"] %>分</div>
      </div>
      <div class="clear"></div>
      <div class="review_btn">
        <a class="jiexi_btn" id="btn_<%= question.attributes['id'] %>">解析</a>
        <a class="biji_btn"
           name="note_<%= question.attributes["id"] %>" id="note_<%= question.attributes["id"] %>"
           onclick="javascript:cuoti_note(<%= question.attributes["id"] %>, <%= question_with_answer.attributes["id"] %>);">笔记</a>
        <a onclick="javascript:document.getElementById('status').submit();">移出</a>
      </div>
      <input type="hidden" id="btn_<%= question.attributes["id"] %>_answer" type="hidden" value="<%= answers.join(";") %>"/>
      <input type="hidden" id="btn_<%= question.attributes["id"] %>_analysis" type="hidden" value="<%=question.elements["analysis"].nil? ? '' : question.elements["analysis"].text %>"/>
      <%= form_for :exam, :html=> {:id => :status, :name => :exam_form}, :url => "/exam_lists/#{params[:id]}/delete_problem" do |f|%>
        <input type="hidden" value="<%= question_with_answer.attributes["id"] %>" id="problem_id" name="problem_id"/>
        <input type="hidden" value="<%= question.attributes["id"] %>" name="question_id" />
        <input type="hidden" value="<%= params[:page].nil? ? 1:params[:page] %>" name="page" />
      <% end %>
      <div class="clear"></div>
    </div>
  <% end %>
  <input type="hidden" value="<%= attr.chop %>" id="questions" />
</div>




