<%= javascript_include_tag "#{Constant::SERVER_PATH}/javascripts/answer_sheet.js" %>
<% if @note and @doc %>
  <div class="noteBook_left">
    <div class="se_nb_box">
      <div class="searchNotebook">
        <%= form_tag "/user/notes/#{params[:id]}/search", :method => "post" do -%>
          <input type="text" class="se_nb_input" name="note_text" id="note_text"
                 value="<% if session[:note_text] %><%= session[:note_text] %><% else %>请输入笔记关键字查询...<% end %>"
                 onfocus="javascript:$('note_text').value='';" />
          <button type="submit" name="button" class="se_nb_btn"></button>
        <% end -%>
      </div>
    </div>
    <div class="clear"></div>
    <div class="notebook_con">
      <ul>
        <% @doc.root.elements["problems"].each_element do |problem|
          problem.elements["questions"].each_element do |question|
            unless (question.elements["note_text"].nil? or question.elements["note_text"].text.nil? or
                  question.elements["note_text"].text == "") %>
              <li class="nb_li_bg" id="show_note_<%= question.attributes["id"] %>"
                  onclick="javascript:note_question_info(<%= question.attributes["id"].to_i %>)">
                    <%= question.elements["note_text"].text %>
              </li>
              <li class="nb_li_bg00" style="display:none;" id="hidden_note_<%= question.attributes["id"] %>">
                <div class="nb_li_con" id="note_<%= question.attributes["id"] %>">
                  <%= question.elements["note_text"].text %>
                  <div class="nb_li_btn">
                    <button class="Uncertain" onclick="javascript:update_note(<%= question.attributes["id"] %>);">编辑笔记</button>
                  </div>
                </div>
                <div class="bn_write" id="start_note_<%= question.attributes["id"] %>">
                  <%= form_tag "/user/notes/#{question.attributes["id"]}/update_note",
                    :class => "required-validate", :method => "post" do -%>
                  <input type="hidden" id="category_id_<%= question.attributes["id"] %>"
                         name="category_id_<%= question.attributes["id"] %>" value="<%= params[:id] %>"/>
                    <input type="hidden" id="q_xpath_<%= question.attributes["id"] %>"
                           name="q_xpath_<%= question.attributes["id"] %>" value="<%= question.xpath %>"/>
                    <textarea cols="" rows="" id="note_text_<%= question.attributes["id"] %>"
                              name="note_text_<%= question.attributes["id"] %>"><%= question.elements["note_text"].text %></textarea>
                    <div class="nb_li_btn"><button type="submit" class="save">保存</button></div>
                  <% end %>
                </div>
              </li>
            <% end
          end
        end %>
      </ul>
      <div class="ep_prevNext_bj">
        <% if params[:page] and params[:page].to_i > 1 %>
          <div class="ep_goLeft"><a href="<%= request.path %>?page=<%= params[:page].to_i - 1 %>">&lt;</a></div>
        <% end %>&nbsp;&nbsp;
        <% current_page = (params[:page] and params[:page].to_i > 1) ? params[:page].to_i : 1 %>
        <div class="ep_number"><span class="orange"><%= current_page %></span>/<%= @total_page %></div>
        <% if @has_next_page %>
          <div class="ep_goRight"><a href="<%= request.path %>?page=<%= current_page + 1 %>">&gt;</a></div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="noteBook_right">
    <% @doc.root.elements["problems"].each_element do |problem|
      problem.elements["questions"].each_element do |question|
        unless (question.elements["note_text"].nil? or question.elements["note_text"].text.nil? or
              question.elements["note_text"].text == "") %>
          <div class="nb_r_box" id="question_info_<%= question.attributes["id"] %>" style="display:none;">
            <div class="nb_r_title">原题</div>
            <div class="nb_r_con">
              <!--原题-->
              <div class="part_passage">
                <div class="p_contents">
                  <p><%= problem.elements["title"].text.to_s.html_safe %></p>
                </div>
                <div class="fraction"><%= problem.attributes["score"] %>分</div>
              </div>
              <%= render :partial => "/user/notes/question_with_answer", :object => question %>
            </div>
          </div>
        <% end
      end
    end %>
  </div>
<% else %>
  <div class="noteBook_left">您当前未做任何笔记。</div>
<% end %>